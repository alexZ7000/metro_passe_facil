name: CI

on:
    push:
        branches:
            - "*"
    pull_request:
        branches:
            - "*"

jobs:
    expo-ci:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3

            - name: Set up Node.js
              uses: actions/setup-node@v3
              with:
                  node-version: "20.11.0"

            - name: Cache node modules
              uses: actions/cache@v3
              with:
                  path: node_modules
                  key:
                      ${{ runner.os }}-node-${{ hashFiles('package-lock.json')
                      }}
                  restore-keys: |
                      ${{ runner.os }}-node-

            - name: Install dependencies
              run: npm ci

            - name: Install Expo CLI
              run: npm install -g expo

            - name: Install required web dependencies
              run: npx expo install react-native-web react-dom @expo/metro-runtime

            - name: Run tests
              run: npm test

            - name: Export Expo Project
              run: npx expo export
